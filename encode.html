<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encode</title>
</head>
<body>
    <div id="emojiDisplay">ðŸ’©</div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const text = urlParams.get('text');
        const emoji = urlParams.get('emoji');
        const maxLength = 100;

        // Zero Width Steganography encoding
        function encodeTextToEmoji(text, emoji) {
            if (!text) {
                return 'Error: No message provided to encode.';
            }
            // If text length exceeds a certain limit, render a warning
            if (text.length > maxLength) {
                return 'Error: Message too long to encode, max length is ' + maxLength + ' characters.';
            }
            
            // Convert text to binary
            let binary = '';
            for (let i = 0; i < text.length; i++) {
                binary += text.charCodeAt(i).toString(2).padStart(8, '0');
            }
            
            // Map binary to zero-width characters
            // 0 = Zero Width Space (U+200B)
            // 1 = Zero Width Non-Joiner (U+200C)
            let encoded = '';
            for (let bit of binary) {
                encoded += bit === '0' ? '\u200B' : '\u200C';
            }
            
            // Append hidden text to emoji
            return (emoji || 'ðŸ’©') + encoded;
        }

        // Display the emoji with hidden text
        const displayEmoji = encodeTextToEmoji(text, emoji);
        document.getElementById('emojiDisplay').textContent = displayEmoji;
        
        // Render the full decode URL with full path only if encoding was successful
        if (text && text.length <= maxLength) {
            const fullDecodeUrl = `${window.location.origin}${window.location.pathname.split('/').slice(0, -1).join('/')}/decode.html?emoji=${encodeURIComponent(displayEmoji)}`;
            const urlElement = document.createElement('p');
            urlElement.innerHTML = `Decode: <a href="${fullDecodeUrl}">${fullDecodeUrl}</a>`;
            document.body.appendChild(urlElement);
        }
    </script>
</body>
</html>
